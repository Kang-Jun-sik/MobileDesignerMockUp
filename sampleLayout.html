<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="sampleLayout.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
</head>
<body>
<div class="wrapper">
    <div class="designerWrapper">
        <div class="main_area">
            <div class="phone view_2 large" id="phone_1" style="width: 1025px; height: 1024px;">
                <div id="phone-container">
                    <div class="drop-target"></div>
                    <div class="drop-target"></div>
                    <div class="drop-target"></div>
                </div>
            </div>
        </div>
        <div class="designerWrapper2">
            <div class="layout2">
                <div class="phone2 small" id="phone_2" style="width: 200px; height: 380px;">
                    <div id="phone-container2">
                    </div>
                </div>
            </div>
            <div class="layout3">
                <div class="phone3 medium" id="phone_3" style="width: 310px; height: 500px;">
                    <div id="phone-container3">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="box b">
        <div class="controlList">
            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading active" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                               aria-expanded="true" aria-controls="collapseOne">
                                #Condition Panel
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <div id="drag-elements">
                                <div class="button">버튼</div>
                                <div class="textBox">텍스트박스</div>
                                <div class="checkBox">체크박스</div>
                                <div class="codePicker">코드피커</div>
                                <div class="dropdownList">드롭다운리스트</div>
                                <div class="splitButton">스프리트버튼</div>
                                <div class="ComboBox">콤보박스</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingTwo">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                #Container Panel
                            </a>
                        </h4>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                        <div class="panel-body">
                            <div id="drag-container">
                                <div class="condition_panel">패널</div>
                                <div class="form_panel">폼패널</div>
                                <div class="grid">그리드</div>
                                <div class="cardlist">카드리스트</div>
                                <div>달력</div>
                                <div>차트</div>
                                <div>트리뷰</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingThree">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                               href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                #ETC
                            </a>
                        </h4>
                    </div>
                    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel"
                         aria-labelledby="headingThree">
                        <div class="panel-body">
                            item3
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>

<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" charset="UTF-8"></script>
<script src="https://bevacqua.github.io/dragula/dist/dragula.js" charset="UTF-8"></script>
<script>
    const size = {
        'small': {
            'width': '375px',
            'height': '667px',
            'preWidth': '200px',
            'preHeight': '380px'
        },
        'medium': {
            'width': '768px',
            'height': '1024px',
            'preWidth': '310px',
            'preHeight': '500px'
        },
        'large': {
            'width': '1025px',
            'height': '1024px',
            'preWidth': '340px',
            'preHeight': '500px'
        }
    }
    const phone1 = document.querySelector('#phone_1'),
        phone2 = document.querySelector('#phone_2'),
        phone3 = document.querySelector('#phone_3')

    document.querySelector('#phone_2').addEventListener('click', function (evt) {
        let phone = [phone1, phone2];
        let phoneClass = {
            'phone_1': '',
            'phone_2': ''
        }
        phone.forEach(item => {
            let className = item.classList;
            if (className.contains('small')) {
                phoneClass[item.id] = 'small';
            } else if (className.contains('medium')) {
                phoneClass[item.id] = 'medium';
            } else if (className.contains('large')) {
                phoneClass[item.id] = 'large';
            }
        })

        phone1.style.width = size[phoneClass.phone_2].width;
        phone1.style.height = size[phoneClass.phone_2].height;
        phone2.style.width = size[phoneClass.phone_1].preWidth;
        phone2.style.height = size[phoneClass.phone_1].preHeight;

        phone1.classList.remove(phoneClass.phone_1);
        phone1.classList.add(phoneClass.phone_2);
        phone2.classList.remove(phoneClass.phone_2);
        phone2.classList.add(phoneClass.phone_1);
    })

    document.querySelector('#phone_3').addEventListener('click', function (evt) {
        let phone = [phone1, phone3];
        let phoneClass = {
            'phone_1': '',
            'phone_3': ''
        }
        phone.forEach(item => {
            let className = item.classList;
            if (className.contains('small')) {
                phoneClass[item.id] = 'small';
            } else if (className.contains('medium')) {
                phoneClass[item.id] = 'medium';
            } else if (className.contains('large')) {
                phoneClass[item.id] = 'large';
            }
        })

        phone1.style.width = size[phoneClass.phone_3].width;
        phone1.style.height = size[phoneClass.phone_3].height;
        phone3.style.width = size[phoneClass.phone_1].preWidth;
        phone3.style.height = size[phoneClass.phone_1].preHeight;

        phone1.classList.remove(phoneClass.phone_1);
        phone1.classList.add(phoneClass.phone_3);
        phone3.classList.remove(phoneClass.phone_3);
        phone3.classList.add(phoneClass.phone_1);
    })

    // 아코디언 자동 접히기 방지
    $('.collapse').collapse({toggle: false});
    // 아코디언 collapse event
    $('.panel-collapse').on('show.bs.collapse', function () {
        $(this).siblings('.panel-heading').addClass('active');
    });
    $('.panel-collapse').on('hide.bs.collapse', function () {
        $(this).siblings('.panel-heading').removeClass('active');
    });

    //dragula 로직
    //dragula API : https://github.com/bevacqua/dragula
    var drake1 = dragula(
        {
            revertOnSpill: true,
            copy: function (el, source) {
                return source.id === 'drag-elements' || source.id === 'drag-container';
            },
            accepts: function (el, target, source, sibling) {
                // if (target.className === 'drop-target')
                //     return true; // elements can be dropped in any of the `containers` by default
                // return false;
                return true
            },
            copySortSource: false,
        })
        .on('drag', function (el) {
            console.log('drag Event : ' + el.className);
        })
        .on('drop', function (el) {
            el.classList.add(uuidv4()); //=> 밑에 함수 태울때 re-size className 중복시 리사이즈 핸들이 작동이 안되어 고유 아이디 부여
            canResizeable(el);
            console.log('drop Event : ' + el.innerHTML);
        })
        .on('over', function (el) {
            console.log('over Event : ' + el.innerHTML);
        })
        .on('out', function (el) {
            console.log('out Event : ' + el.innerHTML);
        });

    drake1.containers.push(document.querySelector('#drag-elements'));
    drake1.containers.push(document.querySelector('#drag-container'));
    Array.from(document.querySelectorAll('.drop-target')).forEach(function (item) {
        drake1.containers.push(item);
    })
    drake1.containers.push(document.querySelector('#phone_1'));

    var drake2 = dragula(
        {
            moves: function (el, container, handle) {
                return handle.className === 'drop-target';
            }
        })
        .on('drag', function (el) {
            console.log('drag Event : ' + el.innerHTML);
        })
        .on('drop', function (el) {
            console.log('drop Event : ' + el.innerHTML);
        })
        .on('over', function (el) {
            console.log('over Event : ' + el.innerHTML);
        })
        .on('out', function (el) {
            console.log('out Event : ' + el.innerHTML);
        });
    drake2.containers.push(document.querySelector('#phone-container'));


    function uuidv4() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    function canResizeable(el) {
        var clsName = "." + el.classList[el.classList.length - 1];
        var storeContainer = [];
        $(clsName).resizable(
            {
                delay: 0,
                resize: function (e, ui) {
                    e.stopPropagation();
                },
                start: function (e, ui) {
                    //dragula 비활성화
                    // drake1.destory();
                    e.stopPropagation();
                },
                stop: function (e, ui) {
                    //dragula 활성화
                    e.stopPropagation();
                },
            }
        );

        /*
            {
              //minWidth: 100,
              //maxWidth: 600,
              handles: "e , s"
            })
            */

    }
</script>
</html>
